<!DOCTYPE html><html lang="en"><head><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><meta charset="UTF-8"><meta name="viewport" content="width=1280,initial-scale=1"><title>Space Blaster | Man Games</title><link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet"><style>:root{--primary:#AC92EC;--accent:#4FC1E9;--bg:#2D3436;--text:#F5F7FA;--enemy:#ED5565}*{margin:0;padding:0;box-sizing:border-box}body{font-family:Fredoka,sans-serif;background:radial-gradient(circle at center,#1b2735 0,#090a0f 100%);color:var(--text);display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;overflow:hidden;touch-action:none}.game-container{position:relative;background:rgba(0,0,0,.5);padding:5px;border-radius:20px;box-shadow:0 0 30px rgba(79,193,233,.3);border:2px solid #4fc1e9;outline:0}canvas{background:0 0;border-radius:15px;display:block;cursor:none}.ui-panel{display:flex;justify-content:space-between;width:100%;max-width:500px;margin-bottom:.5rem;padding:0 5px;align-items:center}.score-box{background:rgba(255,255,255,.1);padding:8px 15px;border-radius:15px;font-size:1rem;font-weight:700;backdrop-filter:blur(5px);border:1px solid rgba(255,255,255,.2);display:flex;align-items:center;gap:8px}.btn{background:var(--accent);color:#fff;border:none;padding:10px 25px;border-radius:50px;font-family:inherit;font-weight:700;font-size:1rem;cursor:pointer;box-shadow:0 0 15px rgba(79,193,233,.5);transition:all .2s}.btn:hover{transform:scale(1.05);box-shadow:0 0 25px rgba(79,193,233,.8)}.btn-secondary{background:0 0;border:2px solid #fff;box-shadow:none}.btn-home{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.3);margin-top:15px;text-decoration:none;display:inline-block;padding:8px 20px;border-radius:50px;color:#fff;font-weight:700;font-size:.9rem;backdrop-filter:blur(5px);transition:all .2s}.btn-home:hover{background:rgba(255,255,255,.2);transform:translateY(-2px)}.overlay{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(20,20,30,.95);padding:2rem;border-radius:20px;text-align:center;box-shadow:0 0 50px rgba(79,193,233,.2);min-width:320px;z-index:10;border:1px solid rgba(79,193,233,.3)}#startScreen{display:block}#gameOverModal{display:none}h1{color:var(--accent);font-size:2.5rem;margin-bottom:.5rem;text-shadow:0 0 10px var(--accent)}h2{color:#fff;font-size:1.5rem;margin-bottom:1.5rem}.final-score{font-size:1.5rem;margin-bottom:1.5rem;color:#fff}.name-input{margin:10px 0;padding:10px;border-radius:10px;border:2px solid #4fc1e9;background:rgba(0,0,0,.5);color:#fff;font-family:inherit;font-size:1rem;width:80%;display:none;text-align:center}.button-group{display:flex;gap:10px;justify-content:center;margin-top:10px}.controls-hint{margin-top:1rem;color:#888;font-size:.9rem;text-align:center}.fire-btn{position:absolute;bottom:30px;right:30px;width:80px;height:80px;background:rgba(237,85,101,.6);border:4px solid #fff;border-radius:50%;color:#fff;font-size:30px;display:none;align-items:center;justify-content:center;user-select:none;z-index:100;backdrop-filter:blur(5px);box-shadow:0 0 20px rgba(237,85,101,.4);touch-action:manipulation}.fire-btn:active{transform:scale(.95);background:rgba(237,85,101,.8)}@media (hover:none) and (pointer:coarse){.fire-btn{display:flex}}body.mode-tv{cursor:none}body.mode-tv .btn:focus{outline:5px solid var(--accent);transform:scale(1.1)}</style></head><body><div class="ui-panel"><div class="score-box">🚀 <span id="score">0</span></div><div class="score-box">🌊 Wave: <span id="waveDisplay">1</span></div><div class="score-box">🏆 <span id="highScoreText">Player</span>: <span id="highScore">0</span></div><div class="score-box">❤️ <span id="lives">3</span></div><button class="btn btn-secondary" style="padding:5px 15px;font-size:.8rem" onclick="toggleFullScreen()">⛶</button></div><div class="game-container" id="gameContainer" tabindex="0"><canvas id="gameCanvas" width="500" height="600"></canvas><div id="startScreen" class="overlay"><h1>SPACE BLASTER</h1><h2>Defend the Galaxy!</h2><button class="btn" onclick="startGame()">LAUNCH MISSION</button><p class="controls-hint">Mouse/Numpad (4,6) to Move • Left Click/5 to Toggle Auto-Shoot • F for Fullscreen</p></div><div id="gameOverModal" class="overlay"><h1 id="gameOverTitle" style="color:#ed5565">MISSION FAILED</h1><p class="final-score">Score: <span id="finalScore">0</span></p><input type="text" id="playerNameInput" class="name-input" placeholder="Enter your name" maxlength="10"><div class="button-group"><button class="btn" onclick="handleGameOverAction()">RETRY</button> <button class="btn btn-secondary" onclick="showStartScreen()">MENU</button></div></div><div id="fireBtn" class="fire-btn">🔥</div></div><a href="#" class="btn btn-home" onclick="goHome(event)">🏠 BACK TO HOME</a><script>const SoundManager={ctx:null,init(){try{this.ctx=new(window.AudioContext||window.webkitAudioContext),this.ctx.resume()}catch(e){console.warn("AudioContext not supported or failed to init",e)}},playTone(e,t,a,o=.1){if(this.ctx)try{"suspended"===this.ctx.state&&this.ctx.resume();const s=this.ctx.createOscillator(),l=this.ctx.createGain();s.type=t,s.frequency.setValueAtTime(e,this.ctx.currentTime),l.gain.setValueAtTime(o,this.ctx.currentTime),l.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+a),s.connect(l),l.connect(this.ctx.destination),s.start(),s.stop(this.ctx.currentTime+a)}catch(e){console.warn("Audio error:",e)}},playLaser(){this.playTone(800,"sawtooth",.1,.05),setTimeout(()=>this.playTone(600,"sawtooth",.1,.05),50)},playExplosion(){this.playTone(150,"sawtooth",.1,.2),setTimeout(()=>this.playTone(50,"square",.2,.2),50)},playExplosionHeavy(){this.playTone(100,"square",.3,.3),setTimeout(()=>this.playTone(40,"sawtooth",.4,.3),100)},playExplosionZap(){this.playTone(300,"sawtooth",.1,.2),this.playTone(100,"sine",.2,.2)},playBossExplosion(){this.playTone(100,"sawtooth",.5,.4),setTimeout(()=>this.playTone(80,"square",.5,.4),200),setTimeout(()=>this.playTone(60,"sawtooth",.8,.4),400),setTimeout(()=>this.playTone(40,"square",1,.4),600)},playPowerup(){this.playTone(600,"sine",.1,.1),setTimeout(()=>this.playTone(900,"sine",.2,.1),100)},playCoin(){this.playTone(1e3,"sine",.1,.1),setTimeout(()=>this.playTone(1500,"sine",.2,.1),100)}};try{SoundManager.init()}catch(e){console.error("SoundManager init failed",e)}const canvas=document.getElementById("gameCanvas"),ctx=canvas.getContext("2d"),scoreEl=document.getElementById("score"),waveEl=document.getElementById("waveDisplay"),livesEl=document.getElementById("lives"),highScoreEl=document.getElementById("highScore"),highScoreTextEl=document.getElementById("highScoreText"),startScreen=document.getElementById("startScreen"),gameOverModal=document.getElementById("gameOverModal"),finalScoreEl=document.getElementById("finalScore"),nameInput=document.getElementById("playerNameInput"),gameOverTitle=document.getElementById("gameOverTitle");let score=0,wave=1,highScore=0,highScoreName="Player",lives=3,isGameOver=!1,frameCount=0,bossesSinceLastCoin=0;const player={x:canvas.width/2,y:canvas.height-80,width:40,height:40,speed:5,color:"#4FC1E9",weaponType:"normal",bulletCount:1,summon:{active:!1,level:0,x:0,y:0,angle:0,bossData:null,shootTimer:0}};let bullets=[],enemyBullets=[],enemies=[],particles=[],powerups=[],stars=[],waveInProgress=!1,enemiesToSpawn=[],spawnTimer=0,bossActive=!1,mouseX=canvas.width/2,isMouseDown=!1,shootTimer=0,isAutoShooting=!1,keys={};const EnemyTypes={BASIC:{type:"basic",hp:1,speed:2,color:"#ED5565",size:30,score:100,eyeColor:"white"},FAST:{type:"fast",hp:1,speed:5,color:"#FFCE54",size:25,score:200,eyeColor:"red"},TANK:{type:"tank",hp:6,speed:1,color:"#DA4453",size:50,score:300,eyeColor:"yellow"},SHOOTER:{type:"shooter",hp:3,speed:1.5,color:"#AC92EC",size:35,score:250,shootRate:100,eyeColor:"cyan"},ZIGZAG:{type:"zigzag",hp:2,speed:2.5,color:"#A0D468",size:30,score:250,eyeColor:"purple"}},Bosses=[{name:"The Guardian",hp:100,color:"#D8334A",size:80,pattern:"shield",speed:1,summonType:EnemyTypes.BASIC},{name:"Speedster",hp:150,color:"#4FC1E9",size:60,pattern:"tracking",speed:3,summonType:EnemyTypes.FAST},{name:"Iron Clad",hp:300,color:"#656D78",size:100,pattern:"tank",speed:.5,summonType:EnemyTypes.TANK},{name:"Swarm Lord",hp:200,color:"#967ADC",size:90,pattern:"swarm",speed:1,summonType:EnemyTypes.BASIC},{name:"Laser Eye",hp:250,color:"#E9573F",size:85,pattern:"laser",speed:1.5,summonType:EnemyTypes.SHOOTER},{name:"The Mothership",hp:500,color:"#F6BB42",size:120,pattern:"omega",speed:.8,summonType:EnemyTypes.ZIGZAG}];function loadHighScore(){highScore=localStorage.getItem("spaceBlasterHighScore")||0,highScoreName=localStorage.getItem("spaceBlasterHighScoreName")||"Player",highScoreEl.textContent=highScore,highScoreTextEl.textContent=highScoreName}function saveHighScore(e,t){e>highScore&&(highScore=e,highScoreName=t,localStorage.setItem("spaceBlasterHighScore",highScore),localStorage.setItem("spaceBlasterHighScoreName",highScoreName),highScoreEl.textContent=highScore,highScoreTextEl.textContent=highScoreName)}function initStars(){for(let e=0;e<10;e++)stars.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,size:2*Math.random(),speed:1*Math.random()+.2,alpha:.5*Math.random()+.3})}function startGame(){startScreen.style.display="none",gameOverModal.style.display="none",SoundManager.ctx&&"suspended"===SoundManager.ctx.state&&SoundManager.ctx.resume(),resetGame(),requestAnimationFrame(update)}function resetGame(){score=0,lives=3,wave=1,player.weaponType="normal",player.bulletCount=1,player.x=canvas.width/2,player.summon={active:!1,level:0,x:0,y:0,angle:0,bossData:null,shootTimer:0},bossesSinceLastCoin=0,bullets=[],enemyBullets=[],enemies=[],particles=[],powerups=[],enemiesToSpawn=[],waveInProgress=!1,bossActive=!1,isGameOver=!1,startWave(1),updateUI()}function focusFirstButton(e){const t=e.querySelector("button");t&&t.focus()}function showStartScreen(){gameOverModal.style.display="none",startScreen.style.display="block",isGameOver=!0,focusFirstButton(startScreen)}function handleGameOverAction(){if("none"!==nameInput.style.display){const e=nameInput.value.trim()||"Anonymous";saveHighScore(score,e)}startGame()}function update(){if(!isGameOver)try{frameCount++,ctx.clearRect(0,0,canvas.width,canvas.height),updateStars(),updatePlayer(),updateSummon(),updateBullets(),updateEnemyBullets(),updateEnemies(),updatePowerups(),updateParticles(),updateWave(),drawStars(),drawPlayer(),drawSummon(),drawBullets(),drawEnemyBullets(),drawEnemies(),drawPowerups(),drawParticles(),drawBossHealth(),requestAnimationFrame(update)}catch(e){console.error("Game Loop Error:",e),ctx.fillStyle="rgba(0, 0, 0, 0.8)",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.fillStyle="red",ctx.font="16px Arial",ctx.textAlign="left",ctx.fillText("Error: "+e.message,10,50),ctx.fillText("Check console for details",10,80)}}function startWave(e){if(wave=e,waveInProgress=!0,bossActive=!1,enemiesToSpawn=[],wave%5==0){let e=wave/5-1,t=e%Bosses.length,a=1+.5*Math.floor(e/Bosses.length);spawnBoss(Bosses[t],a)}else{let e=5+2*wave;for(let t=0;t<e;t++){let e=EnemyTypes.BASIC,t=Math.random();wave>1&&t>.8&&(e=EnemyTypes.FAST),wave>2&&t>.7&&(e=EnemyTypes.ZIGZAG),wave>3&&t>.6&&(e=EnemyTypes.SHOOTER),wave>4&&t>.8&&(e=EnemyTypes.TANK),enemiesToSpawn.push(e)}}const t=document.createElement("div");t.innerText=`WAVE ${wave}`,t.style.position="absolute",t.style.top="40%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.color="#FFF",t.style.fontSize="4rem",t.style.fontWeight="bold",t.style.textShadow="0 0 20px #4FC1E9",t.style.zIndex="100",t.style.opacity="0",t.style.transition="opacity 0.5s",document.querySelector(".game-container").appendChild(t),setTimeout(()=>t.style.opacity="1",100),setTimeout(()=>{t.style.opacity="0",setTimeout(()=>t.remove(),500)},2e3),updateUI()}function updateWave(){if(waveInProgress)if(bossActive)0===enemies.length&&(bossActive=!1,waveInProgress=!1,setTimeout(()=>startWave(wave+1),3e3));else if(enemiesToSpawn.length>0){if(spawnTimer++,spawnTimer>30){spawnEnemy(enemiesToSpawn.shift()),spawnTimer=0}}else 0===enemies.length&&(waveInProgress=!1,setTimeout(()=>startWave(wave+1),2e3))}function spawnBoss(e,t){bossActive=!0,enemies.push({x:canvas.width/2,y:-100,size:e.size,hp:e.hp*t,maxHp:e.hp*t,speed:e.speed,color:e.color,isBoss:!0,name:e.name,pattern:e.pattern,summonType:e.summonType,shootTimer:0,moveTimer:0,summonTimer:0,targetX:canvas.width/2,shieldEntities:[],state:"attack",originalData:e})}function spawnEnemy(e,t,a){let o=e.size,s=void 0!==t?t:Math.random()*(canvas.width-o)+o/2,l=void 0!==a?a:-o;enemies.push({x:s,y:l,size:o,hp:e.hp,maxHp:e.hp,speed:e.speed,color:e.color,type:e.type,score:e.score,eyeColor:e.eyeColor,shootTimer:100*Math.random(),startX:s,time:0,returning:!1,wobbleOffset:100*Math.random()})}function updateStars(){stars.forEach(e=>{e.y+=e.speed,e.y>canvas.height&&(e.y=0,e.x=Math.random()*canvas.width)})}function updatePlayer(){let e=!1;(keys[4]||keys.ArrowLeft||keys[37]||keys[21])&&(player.x-=player.speed,e=!0),(keys[6]||keys.ArrowRight||keys[39]||keys[22])&&(player.x+=player.speed,e=!0),(keys[8]||keys.ArrowUp||keys[38]||keys[19])&&(player.y-=player.speed,e=!0),(keys[2]||keys.ArrowDown||keys[40]||keys[20])&&(player.y+=player.speed,e=!0),e?mouseX=player.x:player.x+=.2*(mouseX-player.x),player.x<player.width/2&&(player.x=player.width/2),player.x>canvas.width-player.width/2&&(player.x=canvas.width-player.width/2),player.y<player.height/2&&(player.y=player.height/2),player.y>canvas.height-player.height/2&&(player.y=canvas.height-player.height/2),isAutoShooting&&shootTimer<=0&&(shoot(),shootTimer="laser"===player.weaponType?45:10),shootTimer>0&&shootTimer--}function updateSummon(){if(!player.summon.active)return;player.summon.angle+=.02;if(player.summon.x=player.x+60*Math.cos(player.summon.angle),player.summon.y=player.y+60*Math.sin(player.summon.angle),player.summon.shootTimer++,player.summon.shootTimer>60){let e=null,t=1/0;if(enemies.forEach(a=>{let o=Math.hypot(a.x-player.summon.x,a.y-player.summon.y);o<t&&(t=o,e=a)}),e){let t=e.x-player.summon.x,a=e.y-player.summon.y,o=Math.atan2(a,t);bullets.push({x:player.summon.x,y:player.summon.y,vx:5*Math.cos(o),vy:5*Math.sin(o),color:player.summon.bossData.color,type:"summon_projectile",damage:.2}),player.summon.shootTimer=0}}}function shoot(){if(SoundManager.playLaser(),"laser"===player.weaponType)return void bullets.push({x:player.x,y:player.y-40,vx:0,vy:-20,color:"#FF0000",type:"laser",width:6,height:60,damage:2.5,penetrate:!0});if("tracking"===player.weaponType)return void bullets.push({x:player.x,y:player.y-20,vx:0,vy:-5,color:"#00FF00",type:"tracking",damage:.5});if("tracking2"===player.weaponType)return void bullets.push({x:player.x,y:player.y-20,vx:0,vy:-5,color:"#FF4500",type:"tracking2",damage:1});let e=player.bulletCount,t=.5;1===e?bullets.push({x:player.x,y:player.y-20,vx:0,vy:-10,color:"#4FC1E9",damage:t}):2===e?(bullets.push({x:player.x-10,y:player.y-20,vx:0,vy:-10,color:"#4FC1E9",damage:t}),bullets.push({x:player.x+10,y:player.y-20,vx:0,vy:-10,color:"#4FC1E9",damage:t})):3===e?(bullets.push({x:player.x,y:player.y-20,vx:0,vy:-10,color:"#4FC1E9",damage:t}),bullets.push({x:player.x-15,y:player.y-20,vx:-1,vy:-10,color:"#4FC1E9",damage:t}),bullets.push({x:player.x+15,y:player.y-20,vx:1,vy:-10,color:"#4FC1E9",damage:t})):e>=4&&(bullets.push({x:player.x-10,y:player.y-20,vx:0,vy:-10,color:"#4FC1E9",damage:t}),bullets.push({x:player.x+10,y:player.y-20,vx:0,vy:-10,color:"#4FC1E9",damage:t}),bullets.push({x:player.x-20,y:player.y-20,vx:-2,vy:-9,color:"#4FC1E9",damage:t}),bullets.push({x:player.x+20,y:player.y-20,vx:2,vy:-9,color:"#4FC1E9",damage:t}))}function updateBullets(){for(let e=bullets.length-1;e>=0;e--){let t=bullets[e];if("tracking"===t.type||"tracking2"===t.type){let e=null,a=1/0;if(enemies.forEach(o=>{let s=Math.hypot(o.x-t.x,o.y-t.y);s<a&&(a=s,e=o)}),e){let a=e.x-t.x,o=e.y-t.y,s=Math.atan2(o,a);t.vx+=.5*Math.cos(s),t.vy+=.5*Math.sin(s);let l=Math.hypot(t.vx,t.vy);l>8&&(t.vx=t.vx/l*8,t.vy=t.vy/l*8)}}t.x+=t.vx,t.y+=t.vy,(t.y<-50||t.y>canvas.height+50||t.x<-50||t.x>canvas.width+50)&&bullets.splice(e,1)}}function updateEnemies(){for(let e=enemies.length-1;e>=0;e--){let t=enemies[e];if(t.isBoss)updateBoss(t);else{if(t.returning){if(t.y-=3*t.speed,t.vx&&(t.x+=t.vx),t.y<-50){enemies.splice(e,1);continue}}else"zigzag"===t.type?(t.y+=t.speed,t.time+=.05,t.x=t.startX+50*Math.sin(t.time)):t.y+=t.speed,t.y>canvas.height+50&&(t.returning=!0,Math.random()<.5?t.x=-t.size:t.x=canvas.width+t.size,t.y=canvas.height+50,t.vx=.01*(canvas.width/2-t.x));"shooter"!==t.type||t.returning||(t.shootTimer--,t.shootTimer<=0&&(enemyShoot(t),t.shootTimer=120))}let a=!1;for(let o=bullets.length-1;o>=0;o--){let s=bullets[o],l=!1;if("laser"===s.type?s.x<t.x+t.size/2&&s.x+s.width>t.x-t.size/2&&s.y<t.y+t.size/2&&s.y+s.height>t.y-t.size/2&&(l=!0):Math.abs(s.x-t.x)<t.size/2+5&&Math.abs(s.y-t.y)<t.size/2+5&&(l=!0),l){if(t.isBoss&&"shield"===t.pattern&&t.shieldEntities.length>0){SoundManager.playTone(100,"square",.1),s.penetrate||bullets.splice(o,1),createParticles(s.x,s.y,"#FFF",2);continue}if(t.hp-=s.damage||1,s.penetrate||bullets.splice(o,1),createParticles(t.x,t.y,t.color,2),t.hp<=0){destroyEnemy(t,e),a=!0;break}}if(t.isBoss&&t.shieldEntities)for(let e=t.shieldEntities.length-1;e>=0;e--){let a=t.shieldEntities[e];if(Math.abs(s.x-a.x)<15&&Math.abs(s.y-a.y)<15){t.shieldEntities.splice(e,1),s.penetrate||bullets.splice(o,1),createParticles(a.x,a.y,"#00FFFF",5),SoundManager.playExplosion();break}}}a||Math.abs(player.x-t.x)<player.width/2+t.size/2&&Math.abs(player.y-t.y)<player.height/2+t.size/2&&(t.isBoss?playerHit():destroyEnemy(t,e),playerHit())}}function updateBoss(e){if(e.y<100)return void(e.y+=2);if("shield"===e.pattern){if(!e.shieldInitialized){e.shieldEntities=[];for(let t=0;t<6;t++)e.shieldEntities.push({angle:t*(Math.PI/3),x:0,y:0});e.shieldInitialized=!0}let t=e.size+20;e.shieldEntities.forEach(a=>{a.angle+=.05,a.x=e.x+Math.cos(a.angle)*t,a.y=e.y+Math.sin(a.angle)*t})}if(e.summonTimer++,e.summonTimer>300&&(e.state="summon",e.summonTimer=0,e.summonCount=0),"summon"===e.state)return void(frameCount%20==0&&(spawnEnemy(e.summonType,e.x+100*(Math.random()-.5),e.y+50),e.summonCount++,createParticles(e.x,e.y+50,"#FFF",5),e.summonCount>=5&&(e.state="attack")));e.moveTimer++,e.shootTimer++,e.moveTimer>60&&(e.targetX=Math.random()*(canvas.width-e.size)+e.size/2,e.moveTimer=0),e.x+=.05*(e.targetX-e.x);let t=60;"rapid"===e.pattern&&(t=20),"tank"===e.pattern&&(t=100),"omega"===e.pattern&&(t=30),"shield"===e.pattern&&(t=80),e.shootTimer>t&&(bossShoot(e),e.shootTimer=0)}function enemyShoot(e){enemyBullets.push({x:e.x,y:e.y+e.size/2,vx:0,vy:5,color:"#AC92EC",size:6,type:"normal"})}function bossShoot(e){if(SoundManager.playLaser(),"shield"===e.pattern)enemyBullets.push({x:e.x,y:e.y+e.size/2,vx:0,vy:6,color:e.color,size:8,type:"normal"});else if("tracking"===e.pattern)enemyBullets.push({x:e.x,y:e.y+e.size/2,vx:0,vy:4,color:e.color,size:8,type:"tracking"});else if("laser"===e.pattern)enemyBullets.push({x:e.x,y:e.y+e.size/2,vx:0,vy:5,color:e.color,size:6,type:"sine",time:0,startX:e.x});else if("tank"===e.pattern)enemyBullets.push({x:e.x,y:e.y+e.size/2,vx:0,vy:4,color:e.color,size:15,type:"normal"});else if("swarm"===e.pattern)for(let t=0;t<5;t++)enemyBullets.push({x:e.x,y:e.y+e.size/2,vx:3*Math.cos(t),vy:3*Math.sin(t)+3,color:e.color,size:6,type:"normal"});else if("omega"===e.pattern)for(let t=0;t<8;t++){let a=.1*frameCount+t*(2*Math.PI)/8;enemyBullets.push({x:e.x,y:e.y,vx:4*Math.cos(a),vy:4*Math.sin(a),color:e.color,size:7,type:"normal"})}}function updateEnemyBullets(){for(let e=enemyBullets.length-1;e>=0;e--){let t=enemyBullets[e];if("tracking"===t.type){if(t.y<canvas.height/2){let e=player.x-t.x;t.vx=.05*e}}else"sine"===t.type&&(t.time+=.1,t.x=t.startX+50*Math.sin(t.time),t.startX+=t.vx);t.x+=t.vx,t.y+=t.vy,Math.abs(player.x-t.x)<player.width/2+t.size/2&&Math.abs(player.y-t.y)<player.height/2+t.size/2?(playerHit(),enemyBullets.splice(e,1)):(t.y>canvas.height||t.y<0||t.x<0||t.x>canvas.width)&&enemyBullets.splice(e,1)}}function destroyEnemy(e,t){enemies.splice(t,1),createParticles(e.x,e.y,e.color,10),e.isBoss?(SoundManager.playBossExplosion(),player.summon.active=!0,player.summon.level++,player.summon.bossData=e.originalData,Math.random()<.3||bossesSinceLastCoin>=1?(spawnPowerup(e.x,e.y,"COIN"),bossesSinceLastCoin=0,console.log("Boss Dropped Coin!")):(bossesSinceLastCoin++,console.log("Boss No Coin. Pity:",bossesSinceLastCoin))):"tank"===e.type?SoundManager.playExplosionHeavy():"shooter"===e.type||"zigzag"===e.type?SoundManager.playExplosionZap():SoundManager.playExplosion(),score+=e.score||100,updateUI(),Math.random()<.15&&spawnPowerup(e.x,e.y)}function spawnPowerup(e,t,a=null){let o=[];o=wave<=5?["B2","B3"]:wave<=10?["B3","B4","LASER","TRACK"]:["B3","B4","LASER","TRACK2"];let s=a||o[Math.floor(Math.random()*o.length)];powerups.push({x:e,y:t,vy:2,type:s})}function updatePowerups(){for(let e=powerups.length-1;e>=0;e--){let t=powerups[e];t.y+=t.vy,Math.abs(player.x-t.x)<30&&Math.abs(player.y-t.y)<30&&(SoundManager.playPowerup(),createParticles(t.x,t.y,"#FFF",5),"B2"===t.type?(player.weaponType="normal",player.bulletCount=2):"B3"===t.type?(player.weaponType="normal",player.bulletCount=3):"B4"===t.type?(player.weaponType="normal",player.bulletCount=4):"LASER"===t.type?player.weaponType="laser":"TRACK"===t.type?player.weaponType="tracking":"TRACK2"===t.type?player.weaponType="tracking2":"COIN"===t.type&&(SoundManager.playCoin(),"undefined"!=typeof GoldManager&&GoldManager.addCoins(1)),powerups.splice(e,1)),t.y>canvas.height&&powerups.splice(e,1)}}function playerHit(){lives--,updateUI(),createParticles(player.x,player.y,"#4FC1E9",20),SoundManager.playExplosion(),lives<=0?gameOver():(player.weaponType="normal",player.bulletCount=1)}function createParticles(e,t,a,o){for(let s=0;s<o;s++)particles.push({x:e,y:t,vx:10*(Math.random()-.5),vy:10*(Math.random()-.5),life:1,color:a})}function updateParticles(){for(let e=particles.length-1;e>=0;e--){let t=particles[e];t.x+=t.vx,t.y+=t.vy,t.life-=.05,t.life<=0&&particles.splice(e,1)}}function drawStars(){stars.forEach(e=>{ctx.fillStyle=`rgba(255, 255, 255, ${e.alpha})`,ctx.beginPath(),ctx.arc(e.x,e.y,e.size,0,2*Math.PI),ctx.fill()}),ctx.globalAlpha=1}function drawPlayer(){ctx.fillStyle=player.color,ctx.beginPath(),ctx.moveTo(player.x,player.y-20),ctx.lineTo(player.x-20,player.y+20),ctx.lineTo(player.x,player.y+10),ctx.lineTo(player.x+20,player.y+20),ctx.closePath(),ctx.fill(),ctx.fillStyle=`rgba(255, 100, 0, ${Math.random()})`,ctx.beginPath(),ctx.moveTo(player.x-10,player.y+15),ctx.lineTo(player.x,player.y+35),ctx.lineTo(player.x+10,player.y+15),ctx.fill()}function drawSummon(){if(!player.summon.active||!player.summon.bossData)return;let e=player.summon,t=e.bossData.size/3;ctx.fillStyle=e.bossData.color,ctx.beginPath(),ctx.arc(e.x,e.y,t/2,0,2*Math.PI),ctx.fill(),drawGooglyEye(e.x-3,e.y-3,3),drawGooglyEye(e.x+3,e.y-3,3)}function drawBullets(){bullets.forEach(e=>{ctx.fillStyle=e.color,"laser"===e.type?ctx.fillRect(e.x-e.width/2,e.y,e.width,e.height):"tracking"===e.type?(ctx.beginPath(),ctx.arc(e.x,e.y,5,0,2*Math.PI),ctx.fill()):"tracking2"===e.type?(ctx.beginPath(),ctx.arc(e.x,e.y,8,0,2*Math.PI),ctx.fill(),ctx.shadowBlur=10,ctx.shadowColor="red",ctx.stroke(),ctx.shadowBlur=0):ctx.fillRect(e.x-2,e.y-5,4,10)})}function drawEnemies(){enemies.forEach(e=>{if(ctx.fillStyle=e.color,e.isBoss)ctx.beginPath(),ctx.arc(e.x,e.y,e.size/2,0,2*Math.PI),ctx.fill(),drawGooglyEye(e.x-15,e.y-10,10),drawGooglyEye(e.x+15,e.y-10,10),ctx.fillStyle="red",ctx.fillRect(e.x-e.size/2,e.y-e.size/2-20,e.size,5),ctx.fillStyle="#0f0",ctx.fillRect(e.x-e.size/2,e.y-e.size/2-20,e.size*(e.hp/e.maxHp),5),"shield"===e.pattern&&e.shieldEntities&&e.shieldEntities.forEach(t=>{ctx.fillStyle="#00FFFF",ctx.beginPath(),ctx.arc(t.x,t.y,10,0,2*Math.PI),ctx.fill(),ctx.strokeStyle="rgba(0, 255, 255, 0.5)",ctx.beginPath(),ctx.moveTo(e.x,e.y),ctx.lineTo(t.x,t.y),ctx.stroke()});else{ctx.beginPath();Math.sin(.2*frameCount+e.wobbleOffset);for(let t=0;t<2*Math.PI;t+=.5){let a=e.size/2+3*Math.sin(.5*frameCount+5*t),o=e.x+Math.cos(t)*a,s=e.y+Math.sin(t)*a;0===t?ctx.moveTo(o,s):ctx.lineTo(o,s)}ctx.closePath(),ctx.fill(),drawGooglyEye(e.x,e.y,e.size/4)}})}function drawGooglyEye(e,t,a){ctx.fillStyle="white",ctx.beginPath(),ctx.arc(e,t,a,0,2*Math.PI),ctx.fill();let o=player.x-e,s=player.y-t,l=Math.atan2(s,o),n=.4*a;ctx.fillStyle="black",ctx.beginPath(),ctx.arc(e+Math.cos(l)*n,t+Math.sin(l)*n,a/2.5,0,2*Math.PI),ctx.fill()}function drawEnemyBullets(){enemyBullets.forEach(e=>{ctx.fillStyle=e.color,ctx.beginPath(),ctx.arc(e.x,e.y,e.size,0,2*Math.PI),ctx.fill()})}function drawBossHealth(){}function drawPowerups(){powerups.forEach(e=>{"COIN"===e.type?(ctx.fillStyle="#FFD700",ctx.beginPath(),ctx.arc(e.x,e.y,15,0,2*Math.PI),ctx.fill(),ctx.fillStyle="#B8860B",ctx.font="bold 16px sans-serif",ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText("$",e.x,e.y+1)):(ctx.fillStyle="#FFCE54",ctx.beginPath(),ctx.arc(e.x,e.y,15,0,2*Math.PI),ctx.fill(),ctx.fillStyle="#000",ctx.font="bold 10px Arial",ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText(e.type,e.x,e.y))})}function drawParticles(){particles.forEach(e=>{ctx.globalAlpha=e.life,ctx.fillStyle=e.color,ctx.beginPath(),ctx.arc(e.x,e.y,3,0,2*Math.PI),ctx.fill()}),ctx.globalAlpha=1}function updateUI(){scoreEl.textContent=score,livesEl.textContent=lives,waveEl.textContent=wave}function gameOver(){isGameOver=!0,finalScoreEl.textContent=score,score>highScore?(gameOverTitle.textContent="NEW HIGH SCORE!",gameOverTitle.style.color="#FFCE54",nameInput.style.display="block",nameInput.focus()):(gameOverTitle.textContent="MISSION FAILED",gameOverTitle.style.color="#ED5565",nameInput.style.display="none"),gameOverModal.style.display="block","undefined"!=typeof TimeManager&&TimeManager.syncTimeRemote(!0),focusFirstButton(gameOverModal)}loadHighScore(),initStars(),canvas.addEventListener("mousemove",e=>{const t=canvas.getBoundingClientRect(),a=canvas.width/t.width;mouseX=(e.clientX-t.left)*a}),canvas.addEventListener("mousedown",()=>isAutoShooting=!isAutoShooting),canvas.addEventListener("mouseup",()=>isMouseDown=!1),canvas.addEventListener("touchmove",e=>{e.preventDefault();const t=canvas.getBoundingClientRect(),a=canvas.width/t.width,o=e.touches[0];mouseX=(o.clientX-t.left)*a},{passive:!1});const fireBtn=document.getElementById("fireBtn");fireBtn.addEventListener("touchstart",e=>{e.preventDefault(),isMouseDown=!0},{passive:!1}),fireBtn.addEventListener("touchend",e=>{e.preventDefault(),isMouseDown=!1},{passive:!1}),window.addEventListener("keydown",e=>{const t=e.key,a=e.keyCode;keys[t]=!0,keys[a]=!0,(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","4","6","8","2","21","22","19","20"].includes(t)||[37,39,38,40,21,22,19,20].includes(a))&&(mouseX=player.x);let o=!1;"Backspace"!==t&&"Escape"!==t&&8!==a&&27!==a&&461!==a&&10009!==a&&4!==a||(window.location.href="index.html",o=!0),"5"!==t&&"Enter"!==t&&" "!==t&&13!==a&&23!==a||("none"!==startScreen.style.display?startGame():"none"!==gameOverModal.style.display?handleGameOverAction():isAutoShooting=!isAutoShooting,o=!0),"0"===t&&(toggleFullScreen(),o=!0),"f"===t.toLowerCase()&&(toggleFullScreen(),o=!0),o&&(e.preventDefault(),e.stopPropagation())},{passive:!1}),window.addEventListener("keyup",e=>{keys[e.key]=!1,keys[e.keyCode]=!1});const urlParams=new URLSearchParams(window.location.search),mode=urlParams.get("mode");function isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}function toggleFullScreen(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen().catch(e=>{console.log(`Error attempting to enable full-screen mode: ${e.message} (${e.name})`)})}async function goHome(e){e&&e.preventDefault(),"undefined"!=typeof TimeManager&&await TimeManager.syncTimeRemote(!0),window.location.href="index.html"}"mobile"===mode||isTouchDevice()?document.body.classList.add("mode-mobile"):"tv"===mode&&document.body.classList.add("mode-tv"),window.onload=()=>{document.getElementById("gameContainer").focus()},document.getElementById("gameContainer").addEventListener("blur",()=>{setTimeout(()=>document.getElementById("gameContainer").focus(),50)})</script><script src="global.js?v=11"></script></body></html>