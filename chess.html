<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=1280,initial-scale=1"><title>Chess Master | Man Games</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><style>:root{--bg-color:#2c3e50;--board-border:#34495e;--light-square:#eeeed2;--dark-square:#769656;--highlight:rgba(255, 255, 0, 0.5);--possible-move:rgba(0, 0, 0, 0.2);--text-color:#ecf0f1;--accent:#f1c40f;--cursor-color:#e74c3c}*{margin:0;padding:0;box-sizing:border-box;user-select:none}body{font-family:Nunito,sans-serif;background-color:var(--bg-color);color:var(--text-color);display:flex;flex-direction:column;align-items:center;min-height:100vh;padding:20px;overflow:hidden}h1{font-family:Fredoka,sans-serif;margin-bottom:20px;font-size:2.5rem;color:var(--accent);text-shadow:2px 2px 0 #000}.game-container{display:flex;flex-direction:column;align-items:center;gap:20px;background:rgba(0,0,0,.2);padding:30px;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.3);filter:blur(5px);transition:filter .3s ease;outline:0}.game-container.active{filter:none}.controls{display:flex;gap:15px;align-items:center;flex-wrap:wrap;justify-content:center}button{padding:10px 20px;border-radius:10px;border:none;font-family:Fredoka,sans-serif;font-size:1rem;cursor:pointer;transition:transform .2s;background:var(--accent);color:#2c3e50;font-weight:700}button:focus,button:hover{transform:scale(1.05);outline:3px solid var(--cursor-color)}.status{font-size:1.2rem;font-weight:700;min-height:1.5em}.chessboard{width:480px;height:480px;display:grid;grid-template-columns:repeat(8,1fr);grid-template-rows:repeat(8,1fr);border:10px solid var(--board-border);border-radius:5px;background:var(--board-border)}.square{width:100%;height:100%;display:flex;justify-content:center;align-items:center;font-size:3.5rem;cursor:pointer;position:relative;overflow:hidden}.square.light{background-color:var(--light-square)}.square.dark{background-color:var(--dark-square)}.square.selected{background-color:#bbcb2b!important}.square.last-move{background-color:#f5f682!important}.square.cursor-active{box-shadow:inset 0 0 0 5px var(--cursor-color);z-index:10}.square.possible-move::after{content:'';position:absolute;width:25%;height:25%;background-color:rgba(0,0,0,.2);border-radius:50%;pointer-events:none}.square.possible-capture::after{content:'';position:absolute;width:85%;height:85%;border:5px solid rgba(0,0,0,.2);border-radius:50%;background-color:transparent;pointer-events:none}.piece{cursor:grab;z-index:2;line-height:1;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.piece.white{color:#fff;text-shadow:0 0 2px #000,0 0 5px rgba(0,0,0,.5)}.piece.black{color:#000;text-shadow:0 0 2px rgba(255,255,255,.5)}.back-btn{margin-top:20px;color:var(--text-color);text-decoration:none;font-weight:700;opacity:.8;transition:opacity .2s}.back-btn:focus,.back-btn:hover{opacity:1;outline:2px solid var(--cursor-color);border-radius:5px;padding:5px}.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.85);z-index:100;display:flex;justify-content:center;align-items:center;backdrop-filter:blur(5px)}.modal{background:#fff;padding:40px;border-radius:30px;text-align:center;max-width:90%;width:400px;border:5px solid var(--accent);animation:popIn .3s cubic-bezier(.175,.885,.32,1.275)}.modal h2{color:#2c3e50;font-family:Fredoka,sans-serif;font-size:2rem;margin-bottom:30px}.difficulty-btn{display:block;width:100%;margin-bottom:15px;padding:15px;font-size:1.2rem;background:var(--bg-color);color:#fff;border:none;border-radius:15px;cursor:pointer;transition:all .2s}.difficulty-btn:focus,.difficulty-btn:hover{background:var(--secondary);transform:translateY(-3px);box-shadow:0 5px 15px rgba(0,0,0,.2);outline:4px solid var(--cursor-color)}.difficulty-btn.easy{background:#2ecc71}.difficulty-btn.medium{background:#f39c12}.difficulty-btn.hard{background:#e74c3c}@keyframes popIn{from{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}@media (max-width:600px){.chessboard{width:340px;height:340px}.square{font-size:2.2rem}}body.mode-tv{cursor:none}</style></head><body><h1>Chess Master</h1><div class="game-container" id="gameContainer" tabindex="0"><div class="controls"><button onclick="showDifficultyModal()">Change Difficulty</button> <button onclick="resetGame()">Restart Game</button></div><div class="status" id="status">White's Turn</div><div class="chessboard" id="board"></div></div><a href="#" class="back-btn" onclick="goHome(event)">🏠 Back to Home</a><div class="modal-overlay" id="difficultyModal"><div class="modal"><h2>Select Difficulty</h2><button class="difficulty-btn easy" onclick='startGame("easy")'>Easy</button> <button class="difficulty-btn medium" onclick='startGame("medium")'>Medium</button> <button class="difficulty-btn hard" onclick='startGame("hard")'>Hard</button></div></div><script>const boardElement=document.getElementById("board"),statusElement=document.getElementById("status"),modalElement=document.getElementById("difficultyModal"),gameContainer=document.getElementById("gameContainer");let board=[],turn="white",selectedSquare=null,possibleMoves=[],gameActive=!1,currentDifficulty="medium",castlingRights={white:{k:!0,q:!0},black:{k:!0,q:!0}},enPassantTarget=null,kingPositions={white:[7,4],black:[0,4]},cursor=[6,4],cursorHoldInterval=null,lastMove=null;const PIECES={k:"♚",q:"♛",r:"♜",b:"♝",n:"♞",p:"♟"};function showDifficultyModal(){modalElement.style.display="flex",gameContainer.classList.remove("active"),gameActive=!1,setTimeout(()=>{const e=modalElement.querySelector(".difficulty-btn");e&&e.focus()},100)}function startGame(e){currentDifficulty=e,modalElement.style.display="none",gameContainer.classList.add("active"),initBoard(),gameContainer.focus()}function resetGame(){showDifficultyModal()}function initBoard(){board=Array(8).fill(null).map(()=>Array(8).fill(null));const e=(e,t,o)=>{o.forEach((o,n)=>{board[e][n]={type:o,color:t}})},t=["r","n","b","q","k","b","n","r"],o=Array(8).fill("p");e(0,"black",t),e(1,"black",o),e(6,"white",o),e(7,"white",t),kingPositions={white:[7,4],black:[0,4]},castlingRights={white:{k:!0,q:!0},black:{k:!0,q:!0}},enPassantTarget=null,turn="white",gameActive=!0,statusElement.textContent="White's Turn",selectedSquare=null,possibleMoves=[],cursor=[6,4],lastMove=null,renderBoard()}function renderBoard(){boardElement.innerHTML="";for(let e=0;e<8;e++)for(let t=0;t<8;t++){const o=document.createElement("div");o.className="square "+((e+t)%2==0?"light":"dark"),o.dataset.row=e,o.dataset.col=t;const n=board[e][t];if(n){const e=document.createElement("span");e.className=`piece ${n.color}`,e.textContent=PIECES[n.type],o.appendChild(e)}selectedSquare&&selectedSquare[0]===e&&selectedSquare[1]===t&&o.classList.add("selected"),lastMove&&(lastMove.from[0]===e&&lastMove.from[1]===t||lastMove.to[0]===e&&lastMove.to[1]===t)&&o.classList.add("last-move");possibleMoves.find(o=>o.to[0]===e&&o.to[1]===t)&&(n?o.classList.add("possible-capture"):o.classList.add("possible-move")),gameActive&&cursor[0]===e&&cursor[1]===t&&o.classList.add("cursor-active"),o.addEventListener("click",()=>{cursor=[e,t],handleSquareClick(e,t)}),boardElement.appendChild(o)}}const SoundManager={ctx:null,init:function(){try{this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext))}catch(e){console.error("AudioContext init failed",e)}},playTone:function(e,t,o,n=.1){try{if(this.ctx||this.init(),!this.ctx)return;const a=this.ctx.createOscillator(),r=this.ctx.createGain();a.type=t,a.frequency.setValueAtTime(e,this.ctx.currentTime),r.gain.setValueAtTime(n,this.ctx.currentTime),r.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+o),a.connect(r),r.connect(this.ctx.destination),a.start(),a.stop(this.ctx.currentTime+o)}catch(e){console.error("playTone failed",e)}},move:function(){this.playTone(300,"sine",.1,.1)},capture:function(){this.playTone(150,"triangle",.15,.2),setTimeout(()=>this.playTone(100,"triangle",.2,.2),50)},select:function(){this.playTone(600,"sine",.05,.05)},gameOver:function(){this.playTone(400,"sine",.2,.2),setTimeout(()=>this.playTone(300,"sine",.2,.2),200),setTimeout(()=>this.playTone(200,"sine",.4,.2),400)}};function handleSquareClick(e,t){try{if(!gameActive)return;if("black"===turn)return;const o=board[e][t];if(o&&o.color===turn)return SoundManager.select(),selectedSquare=[e,t],possibleMoves=getValidMoves(board,turn).filter(o=>o.from[0]===e&&o.from[1]===t),void renderBoard();if(selectedSquare){const o=possibleMoves.find(o=>o.to[0]===e&&o.to[1]===t);o?(makeMove(o),renderBoard(),gameActive&&setTimeout(aiMove,500)):(selectedSquare=null,possibleMoves=[],renderBoard())}}catch(e){console.error("Error in handleSquareClick:",e)}}function makeMove(e,t=!0){const{from:o,to:n,type:a,special:r}=e,i=board[o[0]][o[1]],l=board[n[0]][n[1]];t&&(lastMove={from:o,to:n},l||"enpassant"===r?SoundManager.capture():SoundManager.move()),board[n[0]][n[1]]=i,board[o[0]][o[1]]=null,"castling"===r?6===n[1]?(board[n[0]][5]=board[n[0]][7],board[n[0]][7]=null):2===n[1]&&(board[n[0]][3]=board[n[0]][0],board[n[0]][0]=null):"enpassant"===r?board[o[0]][n[1]]=null:"promotion"===r&&(i.type="q"),"k"===i.type&&(kingPositions[i.color]=[n[0],n[1]],castlingRights[i.color]={k:!1,q:!1}),"r"===i.type&&(0===o[1]&&(castlingRights[i.color].q=!1),7===o[1]&&(castlingRights[i.color].k=!1)),enPassantTarget="p"===i.type&&2===Math.abs(o[0]-n[0])?[(o[0]+n[0])/2,o[1]]:null,turn="white"===turn?"black":"white",t&&(selectedSquare=null,possibleMoves=[],checkGameState())}function checkGameState(){0===getValidMoves(board,turn).length?(SoundManager.gameOver(),isInCheck(board,turn)?(statusElement.textContent=`Checkmate! ${"white"===turn?"Black":"White"} wins!`,gameActive=!1,"black"===turn&&(statusElement.textContent+=" (+1 Gold Coin!)","undefined"!=typeof GoldManager&&GoldManager.addCoins(1)),"undefined"!=typeof TimeManager&&TimeManager.syncTimeRemote(!0)):(statusElement.textContent="Stalemate! It's a draw.",gameActive=!1)):isInCheck(board,turn)?statusElement.textContent=("white"===turn?"White":"Black")+"'s Turn (Check!)":statusElement.textContent=("white"===turn?"White":"Black")+"'s Turn"}function getValidMoves(e,t){let o=[];for(let n=0;n<8;n++)for(let a=0;a<8;a++){const r=e[n][a];r&&r.color===t&&o.push(...getPieceMoves(e,n,a,r))}return o.filter(o=>{const n=JSON.parse(JSON.stringify(e));n[o.to[0]][o.to[1]]=n[o.from[0]][o.from[1]],n[o.from[0]][o.from[1]]=null;let a=kingPositions[t];return"k"===n[o.to[0]][o.to[1]].type&&(a=[o.to[0],o.to[1]]),!isSquareUnderAttack(n,a[0],a[1],"white"===t?"black":"white")})}function getPieceMoves(e,t,o,n){const a=[],r={r:[[0,1],[0,-1],[1,0],[-1,0]],b:[[1,1],[1,-1],[-1,1],[-1,-1]],n:[[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]],q:[[0,1],[0,-1],[1,0],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]],k:[[0,1],[0,-1],[1,0],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]]},i=(e,r,i=null)=>{a.push({from:[t,o],to:[e,r],type:n.type,special:i})};if("p"===n.type){const a="white"===n.color?-1:1,r="white"===n.color?6:1;e[t+a][o]||(t+a===0||t+a===7?i(t+a,o,"promotion"):i(t+a,o),t!==r||e[t+2*a][o]||i(t+2*a,o)),[[t+a,o-1],[t+a,o+1]].forEach(([t,o])=>{if(t>=0&&t<8&&o>=0&&o<8){const a=e[t][o];a&&a.color!==n.color&&(0===t||7===t?i(t,o,"promotion"):i(t,o)),!a&&enPassantTarget&&enPassantTarget[0]===t&&enPassantTarget[1]===o&&i(t,o,"enpassant")}})}else{const a=r[n.type],l=["r","b","q"].includes(n.type);for(let r of a){let a=t+r[0],s=o+r[1];for(;a>=0&&a<8&&s>=0&&s<8;){const t=e[a][s];if(t){t.color!==n.color&&i(a,s);break}if(i(a,s),!l)break;a+=r[0],s+=r[1]}}}return"k"!==n.type||isInCheck(e,n.color)||(castlingRights[n.color].k&&(e[t][5]||e[t][6]||isSquareUnderAttack(e,t,5,"white"===n.color?"black":"white")||isSquareUnderAttack(e,t,6,"white"===n.color?"black":"white")||i(t,6,"castling")),castlingRights[n.color].q&&(e[t][1]||e[t][2]||e[t][3]||isSquareUnderAttack(e,t,3,"white"===n.color?"black":"white")||i(t,2,"castling"))),a}function isInCheck(e,t){const o=kingPositions[t];return isSquareUnderAttack(e,o[0],o[1],"white"===t?"black":"white")}function isSquareUnderAttack(e,t,o,n){const a=t-("white"===n?-1:1);if(a>=0&&a<8){if(o-1>=0){const t=e[a][o-1];if(t&&t.color===n&&"p"===t.type)return!0}if(o+1<8){const t=e[a][o+1];if(t&&t.color===n&&"p"===t.type)return!0}}const r=[[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]];for(let a of r){const r=t+a[0],i=o+a[1];if(r>=0&&r<8&&i>=0&&i<8){const t=e[r][i];if(t&&t.color===n&&"n"===t.type)return!0}}const i=[[0,1],[0,-1],[1,0],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]];for(let a=0;a<i.length;a++){const r=i[a];let l=t+r[0],s=o+r[1],c=0;for(;l>=0&&l<8&&s>=0&&s<8;){c++;const t=e[l][s];if(t){if(t.color===n){const e=t.type;if("q"===e)return!0;if("k"===e&&1===c)return!0;if(a<4&&"r"===e)return!0;if(a>=4&&"b"===e)return!0}break}l+=r[0],s+=r[1]}}return!1}const pieceValues={p:10,n:30,b:30,r:50,q:90,k:900};function evaluateBoard(e){let t=0;for(let o=0;o<8;o++)for(let n=0;n<8;n++){const a=e[o][n];if(a){const e=pieceValues[a.type];t+="white"===a.color?e:-e,3!==o&&4!==o||3!==n&&4!==n||(t+="white"===a.color?1:-1)}}return t}function aiMove(){if(!gameActive)return;if(0===getValidMoves(board,"black").length)return;let e=null;e=getBestMove("easy"===currentDifficulty?2:"medium"===currentDifficulty?3:4),e&&(makeMove(e),renderBoard())}function getBestMove(e){let t=1/0,o=null;const n=getValidMoves(board,"black");n.sort((e,t)=>{const o=board[e.to[0]][e.to[1]],n=board[t.to[0]][t.to[1]];return(n?pieceValues[n.type]:0)-(o?pieceValues[o.type]:0)});for(let a of n){const n=minimax(simulateMove(board,a),e-1,-1/0,1/0,!0);n<t&&(t=n,o=a)}return o}function simulateMove(e,t){const o=JSON.parse(JSON.stringify(e)),{from:n,to:a}=t;return o[a[0]][a[1]]=o[n[0]][n[1]],o[n[0]][n[1]]=null,o}function minimax(b,depth,alpha,beta,isMaximizing){if(0===depth)return evaluateBoard(b);if(isMaximizing){let maxEval=-1/0;const moves=getAllPseudoMoves(b,"white");for(let move of moves){const nextBoard=simulateMove(b,move),eval=minimax(nextBoard,depth-1,alpha,beta,!1);if(maxEval=Math.max(maxEval,eval),alpha=Math.max(alpha,eval),beta<=alpha)break}return maxEval===-1/0?evaluateBoard(b):maxEval}{let minEval=1/0;const moves=getAllPseudoMoves(b,"black");for(let move of moves){const nextBoard=simulateMove(b,move),eval=minimax(nextBoard,depth-1,alpha,beta,!0);if(minEval=Math.min(minEval,eval),beta=Math.min(beta,eval),beta<=alpha)break}return minEval===1/0?evaluateBoard(b):minEval}}function getAllPseudoMoves(e,t){let o=[];for(let n=0;n<8;n++)for(let a=0;a<8;a++){const r=e[n][a];r&&r.color===t&&o.push(...getPieceMoves(e,n,a,r))}return o}function handleModalInput(e,t){const o=Array.from(document.querySelectorAll(".difficulty-btn"));let n=o.indexOf(document.activeElement);-1!==n?["2","ArrowUp"].includes(e)||38===t||19===t?(n=(n-1+o.length)%o.length,o[n].focus()):["8","ArrowDown"].includes(e)||40===t||20===t?(n=(n+1)%o.length,o[n].focus()):(["5","Enter"," "].includes(e)||13===t||23===t)&&o[n].click():o[0].focus()}function moveCursor(e,t){cursor=[e,t],renderBoard()}function handleGameInput(e,t){["2","ArrowUp"].includes(e)||[38,19].includes(t)?moveCursor(Math.max(0,cursor[0]-1),cursor[1]):["8","ArrowDown"].includes(e)||[40,20].includes(t)?moveCursor(Math.min(7,cursor[0]+1),cursor[1]):["4","ArrowLeft"].includes(e)||[37,21].includes(t)?moveCursor(cursor[0],Math.max(0,cursor[1]-1)):["6","ArrowRight"].includes(e)||[39,22].includes(t)?moveCursor(cursor[0],Math.min(7,cursor[1]+1)):(["5","Enter"," "].includes(e)||[13,23].includes(t))&&handleSquareClick(cursor[0],cursor[1])}document.addEventListener("keydown",e=>{const t=e.key,o=e.keyCode,n=37,a=39,r=38,i=40,l=13,s=21,c=22,u=19,d=20,m=23;let f=!1;"Backspace"!==t&&"Escape"!==t&&8!==o&&27!==o&&461!==o&&10009!==o&&4!==o||(window.location.href="index.html",f=!0),"none"!==modalElement.style.display?(["2","8","ArrowUp","ArrowDown"].includes(t)||[r,i,u,d].includes(o)||["5","Enter"," "].includes(t)||[l,m].includes(o))&&(handleModalInput(t,o),f=!0):gameActive?(["2","8","4","6","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t)||[r,i,n,a,u,d,s,c].includes(o)||["5","Enter"," "].includes(t)||[l,m].includes(o))&&(handleGameInput(t,o),f=!0):(["5","Enter"," "].includes(t)||[l,m].includes(o))&&(resetGame(),f=!0),"0"!==t&&"f"!==t.toLowerCase()||(toggleFullScreen(),f=!0),f&&(e.preventDefault(),e.stopPropagation())});const urlParams=new URLSearchParams(window.location.search),mode=urlParams.get("mode");function isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}function toggleFullScreen(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen().catch(e=>{console.log(`Error attempting to enable full-screen mode: ${e.message} (${e.name})`)})}async function goHome(e){e&&e.preventDefault();try{if("undefined"!=typeof TimeManager){const e=TimeManager.syncTimeRemote(!0),t=new Promise(e=>setTimeout(e,500));await Promise.race([e,t])}}catch(e){console.warn("Sync failed or timed out:",e)}window.location.href="index.html"}mode?document.body.classList.add("mode-"+mode):isTouchDevice()&&document.body.classList.add("mode-mobile"),showDifficultyModal(),window.onload=()=>{showDifficultyModal()},gameContainer.addEventListener("blur",()=>{gameActive&&"none"===modalElement.style.display&&setTimeout(()=>gameContainer.focus(),50)}),document.addEventListener("keyup",()=>clearInterval(cursorHoldInterval))</script><script src="global.js?v=11"></script></body></html>