<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=1280,initial-scale=1"><title>Connect Four | Man Games</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet"><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><style>:root{--bg-color:#2c3e50;--board-color:#2980b9;--slot-empty:#34495e;--p1-color:#e74c3c;--p2-color:#f1c40f;--text-color:#fff}*{margin:0;padding:0;box-sizing:border-box;user-select:none}body{font-family:Nunito,sans-serif;background-color:var(--bg-color);color:var(--text-color);display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;overflow:hidden}h1{font-family:Fredoka,sans-serif;font-size:3rem;margin-bottom:1rem;text-shadow:2px 2px 0 #000}.status-bar{margin-bottom:20px;font-size:1.5rem;font-weight:700;background:rgba(0,0,0,.3);padding:10px 30px;border-radius:50px}.turn-indicator{display:inline-block;width:20px;height:20px;border-radius:50%;margin-right:10px}.board{background:var(--board-color);padding:20px;border-radius:20px;display:grid;grid-template-columns:repeat(7,1fr);gap:10px;box-shadow:0 10px 30px rgba(0,0,0,.5);position:relative;outline:0}.column{display:flex;flex-direction:column;gap:10px;cursor:pointer;position:relative}.column:hover .slot.empty{background:rgba(255,255,255,.1)}.column.selected::before{content:'▼';position:absolute;top:-30px;left:50%;transform:translateX(-50%);color:#fff;font-size:20px;animation:bounce .5s infinite alternate}@keyframes bounce{from{top:-30px}to{top:-35px}}.slot{width:60px;height:60px;border-radius:50%;background:var(--slot-empty);position:relative;overflow:hidden;box-shadow:inset 0 5px 10px rgba(0,0,0,.3)}.piece{width:100%;height:100%;border-radius:50%;transform:translateY(-500px);animation:drop .5s forwards cubic-bezier(.5,0,.5,1)}@keyframes drop{to{transform:translateY(0)}}.piece.red{background:var(--p1-color)}.piece.yellow{background:var(--p2-color)}.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.85);z-index:100;display:flex;justify-content:center;align-items:center}.modal{background:#fff;padding:3rem;border-radius:30px;text-align:center;color:#2c3e50;max-width:90%;width:400px;animation:popIn .3s}@keyframes popIn{from{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}button{padding:1rem 2rem;border-radius:50px;border:none;font-family:Fredoka,sans-serif;font-size:1.2rem;cursor:pointer;background:var(--board-color);color:#fff;font-weight:700;margin-top:20px;box-shadow:0 4px 0 #1a5276;transition:all .1s}button:hover{transform:translateY(-2px);box-shadow:0 6px 0 #1a5276}.difficulty-btn{padding:.8rem 1.5rem;font-size:1rem;margin:0 5px;background:#34495e;color:#fff;border:1px solid #5d6d7e;box-shadow:0 4px 0 #2c3e50}.difficulty-btn:hover{background:#2c3e50;box-shadow:0 6px 0 #1a252f}.difficulty-btn.selected{background:#f1c40f;color:#2c3e50;box-shadow:0 4px 0 #d4ac0d}.back-btn{position:absolute;top:20px;left:20px;color:#fff;text-decoration:none;font-weight:700;background:rgba(0,0,0,.3);padding:10px 20px;border-radius:30px}.controls-hint{margin-top:20px;color:rgba(255,255,255,.6);text-align:center}.key-badge{display:inline-block;background:#34495e;padding:2px 8px;border-radius:4px;font-weight:700;margin:0 2px}body.mode-tv{cursor:none}body.mode-tv button:focus{outline:5px solid var(--p2-color);transform:scale(1.05)}</style></head><body><a href="#" class="back-btn" onclick="goHome(event)">🏠 Back to Home</a><h1>Connect Four</h1><div class="status-bar"><span class="turn-indicator" id="turnIndicator" style="background:var(--p1-color)"></span> <span id="statusText">Player 1's Turn</span></div><div class="board" id="board" tabindex="0"></div><div class="controls-hint"><p>Use <span class="key-badge">4</span> (Left) and <span class="key-badge">6</span> (Right) to Select</p><p>Press <span class="key-badge">5</span> to Drop</p></div><div class="modal-overlay" id="startModal"><div class="modal"><h2>Connect Four</h2><p style="margin-bottom:15px">Get 4 in a row to win!</p><p style="margin-bottom:10px;font-size:.9rem;color:#7f8c8d">Select Difficulty:</p><div style="margin-bottom:20px"><button class="difficulty-btn selected" onclick='selectDifficulty("easy")'>Easy</button> <button class="difficulty-btn" onclick='selectDifficulty("medium")'>Medium</button> <button class="difficulty-btn" onclick='selectDifficulty("hard")'>Hard</button></div><button onclick="startGame()">Start Game</button></div></div><div class="modal-overlay" id="gameOverModal" style="display:none"><div class="modal"><h2 id="winnerText">Player 1 Wins!</h2><button onclick="startGame()">Play Again</button> <button onclick="goHome(event)" style="margin-top:10px;background-color:#2980b9;display:block;width:100%">Back to Home</button></div></div><script>const boardEl=document.getElementById("board"),statusText=document.getElementById("statusText"),turnIndicator=document.getElementById("turnIndicator"),startModal=document.getElementById("startModal"),gameOverModal=document.getElementById("gameOverModal"),winnerText=document.getElementById("winnerText"),ROWS=6,COLS=7;let board=[],currentPlayer=1,gameActive=!1,selectedCol=3,currentDifficulty="easy",isCpuThinking=!1;const difficulties=["easy","medium","hard"],SoundManager={ctx:null,init:function(){this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext))},playTone:function(e,t,n,o=.1){this.ctx||this.init();const r=this.ctx.createOscillator(),i=this.ctx.createGain();r.type=t,r.frequency.setValueAtTime(e,this.ctx.currentTime),i.gain.setValueAtTime(o,this.ctx.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.ctx.currentTime+n),r.connect(i),i.connect(this.ctx.destination),r.start(),r.stop(this.ctx.currentTime+n)},drop:function(){this.playTone(300,"sine",.1)},win:function(){this.playTone(400,"sine",.1,.2),setTimeout(()=>this.playTone(600,"sine",.1,.2),100)},draw:function(){this.playTone(200,"triangle",.3)},coin:function(){this.playTone(1200,"sine",.1,.1)}};function selectDifficulty(e){currentDifficulty=e,document.querySelectorAll(".difficulty-btn").forEach(t=>{t.classList.remove("selected"),t.textContent.toLowerCase()===e&&t.classList.add("selected")})}function cycleDifficulty(e){let t=difficulties.indexOf(currentDifficulty);t+=e,t<0&&(t=difficulties.length-1),t>=difficulties.length&&(t=0),selectDifficulty(difficulties[t])}function createBoard(){boardEl.innerHTML="",board=[];for(let e=0;e<7;e++){const t=document.createElement("div");t.classList.add("column"),t.dataset.col=e,t.addEventListener("click",()=>handleColumnClick(e));let n=[];for(let e=0;e<6;e++){const e=document.createElement("div");e.classList.add("slot","empty"),t.appendChild(e),n.push(0)}board.push(n),boardEl.appendChild(t)}updateCursor()}function startGame(){startModal.style.display="none",gameOverModal.style.display="none",currentPlayer=1,gameActive=!0,isCpuThinking=!1,updateStatus(),createBoard(),boardEl.focus()}function updateStatus(){1===currentPlayer?(statusText.textContent="Your Turn",turnIndicator.style.background="var(--p1-color)"):(statusText.textContent="CPU Thinking...",turnIndicator.style.background="var(--p2-color)")}function handleColumnClick(e){gameActive&&1===currentPlayer&&!isCpuThinking&&(selectedCol=e,updateCursor(),dropPiece(e))}function dropPiece(e){const t=board[e];let n=-1;for(let e=5;e>=0;e--)if(0===t[e]){n=e;break}if(-1===n)return;t[n]=currentPlayer;const o=boardEl.children[e].children[n];o.classList.remove("empty");const r=document.createElement("div");r.classList.add("piece"),r.classList.add(1===currentPlayer?"red":"yellow"),o.appendChild(r),SoundManager.drop(),checkWin(e,n)?endGame(currentPlayer):checkDraw()?endGame(0):(currentPlayer=1===currentPlayer?2:1,updateStatus(),2===currentPlayer&&(isCpuThinking=!0,setTimeout(cpuMove,500)))}function cpuMove(){gameActive&&setTimeout(()=>{let e=-1;"easy"===currentDifficulty?e=getRandomMove():"medium"===currentDifficulty?(e=findBestMove(2),-1===e&&(e=findBestMove(1)),-1===e&&(e=getRandomMove())):e=getBestMoveMinimax(),-1!==e&&isValidMove(e)||(e=getRandomMove()),isCpuThinking=!1,dropPiece(e)},500)}function getBestMoveMinimax(){return minimax(board,5,-1/0,1/0,!0).column}function minimax(e,t,n,o,r){const i=getValidMoves(e),c=isTerminalNode(e);if(0===t||c)return c?checkWinPlayer(e,2)?{column:null,score:1e6}:checkWinPlayer(e,1)?{column:null,score:-1e6}:{column:null,score:0}:{column:null,score:scorePosition(e,2)};if(r){let r=-1/0,c=i[Math.floor(Math.random()*i.length)];for(let a of i){const i=minimax(simulateMove(e,a,2),t-1,n,o,!1).score;if(i>r&&(r=i,c=a),(n=Math.max(n,r))>=o)break}return{column:c,score:r}}{let r=1/0,c=i[Math.floor(Math.random()*i.length)];for(let a of i){const i=minimax(simulateMove(e,a,1),t-1,n,o,!0).score;if(i<r&&(r=i,c=a),n>=(o=Math.min(o,r)))break}return{column:c,score:r}}}function getValidMoves(e){let t=[];for(let n=0;n<7;n++)0===e[n][0]&&t.push(n);return t}function isTerminalNode(e){return checkWinPlayer(e,1)||checkWinPlayer(e,2)||0===getValidMoves(e).length}function simulateMove(e,t,n){const o=e.map(e=>[...e]);for(let e=5;e>=0;e--)if(0===o[t][e]){o[t][e]=n;break}return o}function checkWinPlayer(e,t){for(let n=0;n<7;n++)for(let o=0;o<6;o++)if(e[n][o]===t&&(checkDirectionBoard(e,n,o,1,0,t)||checkDirectionBoard(e,n,o,0,1,t)||checkDirectionBoard(e,n,o,1,1,t)||checkDirectionBoard(e,n,o,1,-1,t)))return!0;return!1}function checkDirectionBoard(e,t,n,o,r,i){let c=0;for(let a=0;a<4;a++){const l=t+o*a,s=n+r*a;if(!(l>=0&&l<7&&s>=0&&s<6&&e[l][s]===i))break;c++}return 4===c}function scorePosition(e,t){let n=0;return n+=3*e[3].filter(e=>e===t).length,n}function isValidMove(e){return 0===board[e][0]}function getRandomMove(){let e=[];for(let t=0;t<7;t++)isValidMove(t)&&e.push(t);return 0===e.length?-1:e[Math.floor(Math.random()*e.length)]}function findBestMove(e){for(let t=0;t<7;t++){if(!isValidMove(t))continue;let n=-1;for(let e=5;e>=0;e--)if(0===board[t][e]){n=e;break}board[t][n]=e;let o=checkWin(t,n);if(board[t][n]=0,o)return t}return-1}function checkWin(e,t){const n=board[e][t];return checkDirection(e,t,1,0,n)||checkDirection(e,t,0,1,n)||checkDirection(e,t,1,1,n)||checkDirection(e,t,1,-1,n)}function checkDirection(e,t,n,o,r){let i=1;for(let c=1;c<4;c++){const a=e+n*c,l=t+o*c;if(a<0||a>=7||l<0||l>=6)break;if(board[a][l]!==r)break;i++}for(let c=1;c<4;c++){const a=e-n*c,l=t-o*c;if(a<0||a>=7||l<0||l>=6)break;if(board[a][l]!==r)break;i++}return i>=4}function checkDraw(){return board.every(e=>0!==e[0])}function endGame(e){if(gameActive=!1,0===e)winnerText.textContent="It's a Draw!",winnerText.style.color="#fff",SoundManager.draw();else if(winnerText.textContent=1===e?"You Win!":"CPU Wins!",winnerText.style.color=1===e?"var(--p1-color)":"var(--p2-color)",1===e){SoundManager.win();let e=0;"easy"===currentDifficulty&&(e=.1),"medium"===currentDifficulty&&(e=.35),"hard"===currentDifficulty&&(e=.5),Math.random()<e&&("undefined"!=typeof GoldManager&&GoldManager.addCoins(1),winnerText.innerHTML+="<br><span style='color:#FFD700; font-size:2rem;'>(+1 Coin!)</span>",SoundManager.coin())}"undefined"!=typeof TimeManager&&TimeManager.syncTimeRemote(!0),setTimeout(()=>{gameOverModal.style.display="flex",gameOverModal.querySelector("button").focus()},1e3)}function updateCursor(){Array.from(boardEl.children).forEach((e,t)=>{t===selectedCol?e.classList.add("selected"):e.classList.remove("selected")})}function toggleFullScreen(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen().catch(e=>{console.log(`Error attempting to enable full-screen mode: ${e.message} (${e.name})`)})}async function goHome(e){e&&e.preventDefault();try{if("undefined"!=typeof TimeManager){const e=TimeManager.syncTimeRemote(!0),t=new Promise(e=>setTimeout(e,500));await Promise.race([e,t])}}catch(e){console.warn("Sync failed or timed out:",e)}window.location.href="index.html"}document.addEventListener("keydown",e=>{const t=e.key,n=e.keyCode;let o=!1;"Backspace"!==t&&"Escape"!==t&&8!==n&&27!==n&&461!==n&&10009!==n&&4!==n||(window.location.href="index.html",o=!0),"none"!==startModal.style.display?("4"!==t&&"ArrowLeft"!==t&&37!==n&&21!==n||(cycleDifficulty(-1),o=!0),"6"!==t&&"ArrowRight"!==t&&39!==n&&22!==n||(cycleDifficulty(1),o=!0),(["Enter"," ","5"].includes(t)||13===n||23===n)&&(startGame(),o=!0)):"none"!==gameOverModal.style.display?(["Enter"," ","5"].includes(t)||13===n||23===n)&&(startGame(),o=!0):"ArrowLeft"===t||"4"===t||37===n||21===n?(selectedCol>0&&(selectedCol--,updateCursor()),o=!0):"ArrowRight"===t||"6"===t||39===n||22===n?(selectedCol<6&&(selectedCol++,updateCursor()),o=!0):"Enter"===t||" "===t||"5"===t||13===n||23===n?(handleColumnClick(selectedCol),o=!0):"0"!==t&&"f"!==t.toLowerCase()||(toggleFullScreen(),o=!0),o&&(e.preventDefault(),e.stopPropagation())}),window.addEventListener("DOMContentLoaded",()=>{const e=new URLSearchParams(window.location.search).get("mode");e&&document.body.classList.add(`mode-${e}`)}),window.onload=()=>{boardEl.focus()},boardEl.addEventListener("blur",()=>{"none"===startModal.style.display&&"none"===gameOverModal.style.display&&setTimeout(()=>boardEl.focus(),50)}),createBoard(),setTimeout(()=>startModal.querySelector("button").focus(),100)</script><script src="global.js"></script></body></html>